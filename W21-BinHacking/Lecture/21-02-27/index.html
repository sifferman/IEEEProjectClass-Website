<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>IEEE BinHacking 6 - Wave</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <base target="_blank">

    <link rel="stylesheet" href="/_styles/site.css">
    <link rel="stylesheet" href="/_styles/W21-BinHacking.css">
    <link rel="stylesheet" href="/_styles/lectures.css">

    <!-- codemirror -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js" integrity="sha512-xwrAU5yhWwdTvvmMNheFn9IyuDbl/Kyghz2J3wQRDR8tyNmT8ZIYOd0V3iPYY/g4XdNPy0n/g0NvqGu9f0fPJQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css" integrity="sha512-uf06llspW44/LZpHzHT6qBOIVODjWtv4MxCricRxkzvopAlSWnTf6hpZTFxuuZcuNE9CBQhqE0Seu1CoRk84nQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/clike/clike.min.js" integrity="sha512-hVV7wKBA5Cy5BNo3JkDte8hAobbeXMF8ZTgmmVrshoxcBSSfXn3Z+sigvV6o7bbk6zHSEMWp8RxCbWyPIuPB6Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="/_scripts/init_codemirror.js" defer></script>

</head>

<body>
    <div id="_HEADER_" class="flex flex__row">

        <a id="Back" class="clickable" href="../../" target="_self">
            <img src="/_media/back.svg" alt="back">
        </a>

        <h1>
            Lecture 6 (02.27.21) - Reading/Writing Binary Files
        </h1>

    </div>
    <div id="_MAIN_">
        <div id="Squished">


            <div id="Table-of-Contents" class="bubble">
                <h1>Table of Contents</h1>
                <ul>
                    <li class="clickable"><a href="#Recording" target="_self">
                        Recorded Lecture
                    </a></li>
                    <li class="clickable"><a href="#To-Do" target="_self">
                        To Do
                    </a></li>
                    <li class="clickable"><a href="#WaveFileFormat" target="_self">
                        Wave File Format
                    </a></li>
                    <li class="clickable"><a href="#FileStream" target="_self">
                        C++ File Stream
                    </a></li>
                </ul>
            </div>

            <div id="Recording" class="center center-within">
                <h1>Recorded Lecture</h1>
                <iframe width="560" height="315" src="https://www.youtube.com/embed/hLZEBKudfgo" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>

            <div id="To-Do" class="center">
                <h1>Finish These Before You Leave</h1>
                <ol>
                    <li class="clickable external-link"><a href="../21-02-20/" target="_blank" rel="noopener noreferrer">
                        Ensure you have everything set up from last week.
                    </a></li>
                    <li>
                        Implement all the code sections marked with <em>TO DO</em>.
                    </li>
                    <li>
                        Send your favorite secret message from <code>TESTS/secret.wav</code> in Discord.
                    </li>
                </ol>
            </div>




            <div id="WaveFileFormat">
                <h1>Wave File Format</h1>
                <img class="center" src="/_media/W21-BinHacking/21-02-20/wav-sound-format.gif" alt="Wave File Format">
                <div class="clickable external-link center"><a href="http://soundfile.sapp.org/doc/WaveFormat/" target="_blank" rel="noopener noreferrer">WAVE PCM soundfile format</a></div>
                <p>
                    As you can see, RIFF files are made up of chunks. Each chunk has a ChunkSize (<code>uint32</code>), and ChunkID (<code>char[4]</code>). We can represent them as a C++ struct like so:
                </p>
                <textarea class="code" mode="clike" src="chunk.h" readonly></textarea>
                <p>
                    Next, we see that the RIFF file is one large &ldquo;main&rdquo; chunk with 3 new members: Format (<code>char[4]</code>), &ldquo;fmt&rdquo; SubChunk, &ldquo;data&rdquo; SubChunk. Since &ldquo;main&rdquo; chunk is also a chunk, we can use inheritance to make our lives easier:
                </p>
                <textarea class="code" mode="clike" src="mainchunk.h" readonly></textarea>
            <p>
                Next we need to implement <code>struct FormatChunk</code> and <code>struct DataChunk</code>. Note, both of them are chunks, so they need to extend <code>struct Chunk</code>.
            </p>
            <textarea class="code" mode="clike" src="datachunk.h" readonly></textarea>
            <p>
                According to soundfile.sapp.org/, this structure for the wave file format would be perfect. However, actual wave files have many more subchunks, such as &ldquo;bext&rdquo;, &ldquo;iXML&rdquo;, etc. <a href="https://en.wikipedia.org/wiki/Broadcast_Wave_Format" target="_blank" rel="noopener noreferrer">Wikipedia</a>. Therefore, the starter code for the wave parser has a <code>struct MiscChunk</code> which is structually identical to the <code>struct DataChunk</code>. Therefore, the <code>struct MainChunk</code>, <code>struct MiscChunk</code>, and <code>struct DataChunk</code> look like this:
            </p>
            <textarea class="code" mode="clike" src="mainchunk2.h" readonly></textarea>
            <p>
                Nice! Now we just need to make sure that each struct has a <code>load()</code> and <code>write()</code> method.
            </p>
            </div>



            <div id="FileStream">
                <h1>C++ File Stream</h1>
                <p>
                    C++ has a very easy way to open files: <a href="https://www.cplusplus.com/reference/fstream/" target="_blank" rel="noopener noreferrer"><code>std::fstream</code></a>. <code>std::ifstream</code> opens a file, and you can read just like <code>std::cin</code>. <code>std::ofstream</code> opens a file, and you can write to it just like <code>std::cout</code>.
                </p>
                <p>
                    This example takes in a file called "input_file.txt", and copies it into "output_file.txt".
                </p>
                <textarea class="code" mode="clike" src="fstream.cpp" readonly></textarea>
                <p>
                    However, this example is inaccurate because it does not account for files without a line break at the end. This would suffice for text files, but for binary files where every bit matters, this is unacceptable.
                </p>
                <p>
                    Plus, fstream may convert between different text encodings for different characters between operating systems. Once again, for text, this doesn&rsquo;t really matter. But for binary data where every bit matters, consistency is crucial.
                </p>
                <div class="bubble">
                    <h1>Line Endings</h1>
                    <div>
                        Windows uses CRLF. <code>"\r\n"</code> or <code>0x0D0A</code>.
                    </div>
                    <div>
                        MacOS/Linux uses LF. <code>"\n"</code> or <code>0x0A</code>.
                    </div>
                </div>
                <div class="flex flex__column">
                    <div class="center-within">
                        <h3>Text</h3>
                    <textarea cols="8" rows="3" src="line_ending.txt" readonly></textarea>
                    </div>
                    <div class="center-within">
                        <h3>Windows</h3>
                        <img src="/_media/W21-BinHacking/21-02-20/windows.png" alt="Windows">
                    </div>
                    <div class="center-within">
                        <h3>Unix</h3>
                        <img src="/_media/W21-BinHacking/21-02-20/unix.png" alt="UNIX">
                    </div>
                </div>
                <p>
                    Because of this, we use fstream in <a href="https://en.cppreference.com/w/cpp/io/ios_base/openmode" target="_blank" rel="noopener noreferrer">binary mode</a>. That way, no characters are translated/converted without our permission.
                </p>
                <p>
                    This is a much better example:
                </p>
                <textarea class="code" mode="clike" src="fstream2.cpp" readonly></textarea>
            </div>


        </div>
        <br>
    </div>
</body>

</html>

